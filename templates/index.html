<!-- index.html / Cloudpact Standard HTML Template -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.ProjectName}} - CloudPact App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-gray-900">{{.ProjectName}}</h1>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#" class="text-primary-600 hover:text-primary-700 px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                            <a href="#users" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">Users</a>
                            <a href="#api" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">API</a>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="status-indicator" class="flex items-center">
                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                        <span class="text-sm text-gray-600">Connected</span>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Welcome Section -->
        <div class="px-4 py-6 sm:px-0">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <div class="sm:flex sm:items-center sm:justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">Welcome to {{.ProjectName}}</h2>
                            <p class="mt-2 text-gray-600">Your CloudPact application is running successfully!</p>
                        </div>
                        <div class="mt-4 sm:mt-0">
                            <button id="refresh-data" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="px-4 py-6 sm:px-0">
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
                <!-- API Health -->
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-100 rounded-md flex items-center justify-center">
                                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">API Status</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="api-status">Healthy</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generated Files -->
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-blue-100 rounded-md flex items-center justify-center">
                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Generated Files</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="file-count">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Models -->
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-purple-100 rounded-md flex items-center justify-center">
                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Models</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="model-count">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Functions -->
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-yellow-100 rounded-md flex items-center justify-center">
                                    <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 truncate">Functions</dt>
                                    <dd class="text-lg font-medium text-gray-900" id="function-count">0</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Tables -->
        <div class="px-4 py-6 sm:px-0">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Users Table -->
                <div class="bg-white shadow rounded-lg" id="users">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Sample Users</h3>
                            <button id="add-user" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                                Add User
                            </button>
                        </div>
                    </div>
                    <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody" class="bg-white divide-y divide-gray-200">
                                <!-- Users will be populated by TypeScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- API Documentation -->
                <div class="bg-white shadow rounded-lg" id="api">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">API Endpoints</h3>
                        <p class="mt-1 text-sm text-gray-500">Generated from your CloudPact models</p>
                    </div>
                    <div class="px-4 py-5 sm:p-6">
                        <div class="space-y-4" id="api-endpoints">
                            <!-- API endpoints will be populated by TypeScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="px-4 py-6 sm:px-0">
            <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <div class="text-center">
                        <p class="text-sm text-gray-500">
                            Built with 
                            <span class="font-semibold text-primary-600">CloudPact</span> - 
                            Human/AI collaborative programming language
                        </p>
                        <div class="mt-2 flex justify-center space-x-4 text-xs text-gray-400">
                            <a href="/generated/openapi/spec.yaml" class="hover:text-gray-600">OpenAPI Spec</a>
                            <span>•</span>
                            <a href="/generated/" class="hover:text-gray-600">Generated Files</a>
                            <span>•</span>
                            <a href="/api/health" class="hover:text-gray-600">Health Check</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- TypeScript -->
    <script type="module">
        // Sample User interface (would be generated from CloudPact models)
        interface User {
            id: string;
            name: string;
            email: string;
            status: 'active' | 'inactive';
        }

        // Sample API endpoint interface
        interface APIEndpoint {
            method: string;
            path: string;
            description: string;
            status: 'available' | 'generating';
        }

        class CloudPactApp {
            private users: User[] = [];
            private endpoints: APIEndpoint[] = [];

            constructor() {
                this.init();
            }

            private async init(): Promise<void> {
                await this.loadSampleData();
                this.setupEventListeners();
                this.renderUsers();
                this.renderEndpoints();
                this.updateStats();
                this.startHealthCheck();
            }

            private async loadSampleData(): Promise<void> {
                // Sample users (would come from your CloudPact-generated API)
                this.users = [
                    { id: '1', name: 'Alice Johnson', email: 'alice@example.com', status: 'active' },
                    { id: '2', name: 'Bob Smith', email: 'bob@example.com', status: 'active' },
                    { id: '3', name: 'Carol Davis', email: 'carol@example.com', status: 'inactive' },
                ];

                // Sample API endpoints (would be generated from CloudPact models)
                this.endpoints = [
                    { method: 'GET', path: '/api/users', description: 'List all users', status: 'available' },
                    { method: 'POST', path: '/api/users', description: 'Create a new user', status: 'available' },
                    { method: 'GET', path: '/api/users/{id}', description: 'Get user by ID', status: 'available' },
                    { method: 'PUT', path: '/api/users/{id}', description: 'Update user', status: 'generating' },
                    { method: 'DELETE', path: '/api/users/{id}', description: 'Delete user', status: 'generating' },
                ];
            }

            private setupEventListeners(): void {
                const refreshButton = document.getElementById('refresh-data');
                const addUserButton = document.getElementById('add-user');

                refreshButton?.addEventListener('click', () => {
                    this.refreshData();
                });

                addUserButton?.addEventListener('click', () => {
                    this.showAddUserDialog();
                });
            }

            private renderUsers(): void {
                const tbody = document.getElementById('users-tbody');
                if (!tbody) return;

                tbody.innerHTML = this.users.map(user => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${user.name}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${user.email}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                user.status === 'active' 
                                    ? 'bg-green-100 text-green-800' 
                                    : 'bg-gray-100 text-gray-800'
                            }">
                                ${user.status}
                            </span>
                        </td>
                    </tr>
                `).join('');
            }

            private renderEndpoints(): void {
                const container = document.getElementById('api-endpoints');
                if (!container) return;

                container.innerHTML = this.endpoints.map(endpoint => `
                    <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded ${
                                this.getMethodColor(endpoint.method)
                            }">
                                ${endpoint.method}
                            </span>
                            <code class="text-sm text-gray-800">${endpoint.path}</code>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600">${endpoint.description}</span>
                            <div class="w-2 h-2 rounded-full ${
                                endpoint.status === 'available' ? 'bg-green-400' : 'bg-yellow-400'
                            }"></div>
                        </div>
                    </div>
                `).join('');
            }

            private getMethodColor(method: string): string {
                const colors = {
                    'GET': 'bg-blue-100 text-blue-800',
                    'POST': 'bg-green-100 text-green-800',
                    'PUT': 'bg-yellow-100 text-yellow-800',
                    'DELETE': 'bg-red-100 text-red-800',
                };
                return colors[method as keyof typeof colors] || 'bg-gray-100 text-gray-800';
            }

            private updateStats(): void {
                const modelCount = document.getElementById('model-count');
                const functionCount = document.getElementById('function-count');
                const fileCount = document.getElementById('file-count');

                if (modelCount) modelCount.textContent = '3'; // Would be dynamic
                if (functionCount) functionCount.textContent = '8'; // Would be dynamic  
                if (fileCount) fileCount.textContent = '12'; // Would be dynamic
            }

            private async startHealthCheck(): Promise<void> {
                const checkHealth = async () => {
                    try {
                        const response = await fetch('/api/health');
                        const data = await response.json();
                        
                        const statusIndicator = document.getElementById('status-indicator');
                        const apiStatus = document.getElementById('api-status');
                        
                        if (response.ok) {
                            if (statusIndicator) {
                                statusIndicator.innerHTML = `
                                    <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                                    <span class="text-sm text-gray-600">Connected</span>
                                `;
                            }
                            if (apiStatus) apiStatus.textContent = 'Healthy';
                        } else {
                            throw new Error('API not responding');
                        }
                    } catch (error) {
                        const statusIndicator = document.getElementById('status-indicator');
                        const apiStatus = document.getElementById('api-status');
                        
                        if (statusIndicator) {
                            statusIndicator.innerHTML = `
                                <div class="w-2 h-2 bg-red-400 rounded-full mr-2"></div>
                                <span class="text-sm text-gray-600">Disconnected</span>
                            `;
                        }
                        if (apiStatus) apiStatus.textContent = 'Error';
                    }
                };

                // Check immediately and then every 30 seconds
                await checkHealth();
                setInterval(checkHealth, 30000);
            }

            private async refreshData(): Promise<void> {
                const button = document.getElementById('refresh-data');
                if (button) {
                    button.innerHTML = `
                        <svg class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Refreshing...
                    `;
                }

                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));

                await this.loadSampleData();
                this.renderUsers();
                this.renderEndpoints();
                this.updateStats();

                if (button) {
                    button.innerHTML = `
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Refresh
                    `;
                }
            }

            private showAddUserDialog(): void {
                // Simple prompt for demo - in a real app you'd use a proper modal
                const name = prompt('Enter user name:');
                const email = prompt('Enter user email:');
                
                if (name && email) {
                    const newUser: User = {
                        id: (this.users.length + 1).toString(),
                        name,
                        email,
                        status: 'active'
                    };
                    
                    this.users.push(newUser);
                    this.renderUsers();
                    this.updateStats();
                }
            }
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new CloudPactApp();
        });
    </script>
</body>
</html>